<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>휴식 선택</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  </head>
  <body class="bg-gray-50 text-gray-800 font-sans">
    <main class="max-w-sm mx-auto p-4 space-y-3">
      <h1 class="text-lg font-semibold">예정 휴식 선택</h1>
      <div id="current" class="p-3 bg-white rounded-lg shadow-sm">
        <div id="recTitle" class="font-semibold"></div>
        <div id="recDesc" class="text-sm text-gray-600"></div>
      </div>
      <div class="flex gap-2">
        <button id="confirm" class="flex-1 px-3 py-2 rounded-md bg-blue-500 text-white">이걸로 시작</button>
        <button id="next" class="px-3 py-2 rounded-md bg-gray-200">다른 제안</button>
      </div>
    </main>
    <script>
      async function load() {
        const { pendingBreak = null, pendingBreakCandidates = [], prebreakPayload = null } = await chrome.storage.local.get(['pendingBreak','pendingBreakCandidates','prebreakPayload']);
        window._cands = pendingBreakCandidates || [];
        window._sel = pendingBreak;
        window._payload = prebreakPayload;
        render();
      }
      function render(){
        const r = window._sel || {}; 
        document.getElementById('recTitle').textContent = r.name ? `${r.name} · ${r.duration}분` : '추천 준비 중';
        document.getElementById('recDesc').textContent = r.type || '';
      }
      document.getElementById('confirm').addEventListener('click', async () => {
        if (window._sel) await chrome.storage.local.set({ pendingBreak: window._sel });
        if (window._payload) chrome.runtime.sendMessage({ type: 'breet:startTimer', payload: window._payload });
        window.close();
      });
      document.getElementById('next').addEventListener('click', async () => {
        const list = window._cands || []; const cur = window._sel || {}; 
        if (!list.length) return; 
        const idx = Math.max(0, list.findIndex(c => c.id === cur.id));
        window._sel = list[(idx + 1) % list.length];
        await chrome.storage.local.set({ pendingBreak: window._sel });
        render();
      });
      load();
    </script>
  </body>
  </html>


