<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>휴식 선택</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  </head>
  <body class="bg-gray-50 text-gray-800 font-sans">
    <main class="max-w-sm mx-auto p-4 space-y-3">
      <h1 class="text-lg font-semibold">예정 휴식 선택</h1>
      <div id="list" class="space-y-2"></div>
      <div class="flex gap-2">
        <button id="confirm" class="flex-1 px-3 py-2 rounded-md bg-blue-500 text-white">이걸로 시작</button>
        <button id="next" class="px-3 py-2 rounded-md bg-gray-200">다른 제안</button>
      </div>
    </main>
    <script>
      async function load() {
        const { pendingBreak = null, pendingBreakCandidates = [], prebreakPayload = null } = await chrome.storage.local.get(['pendingBreak','pendingBreakCandidates','prebreakPayload']);
        window._cands = (pendingBreakCandidates && pendingBreakCandidates.length ? pendingBreakCandidates : (pendingBreak ? [pendingBreak] : [])).slice(0,3);
        window._selIdx = 0;
        window._payload = prebreakPayload;
        render();
      }
      function render(){
        const box = document.getElementById('list');
        box.innerHTML = '';
        (window._cands||[]).forEach((c, i) => {
          const div = document.createElement('div');
          div.className = 'p-3 bg-white rounded-lg shadow-sm flex items-center justify-between cursor-pointer ' + (i===window._selIdx ? 'ring-2 ring-blue-500' : '');
          div.addEventListener('click', ()=>{ window._selIdx = i; render(); });
          const left = document.createElement('div');
          left.innerHTML = `<div class="font-semibold">${c?.name||''}</div><div class="text-sm text-gray-600">${c?.type||''}</div>`;
          div.appendChild(left);
          box.appendChild(div);
        });
      }
      document.getElementById('confirm').addEventListener('click', async () => {
        const sel = (window._cands||[])[window._selIdx];
        if (sel) await chrome.storage.local.set({ pendingBreak: sel });
        if (window._payload) chrome.runtime.sendMessage({ type: 'breet:startTimer', payload: window._payload });
        window.close();
      });
      document.getElementById('next').addEventListener('click', async () => {
        const list = window._cands || []; if (!list.length) return;
        window._selIdx = (window._selIdx + 1) % list.length;
        await chrome.storage.local.set({ pendingBreak: list[window._selIdx] });
        render();
      });
      load();
    </script>
  </body>
  </html>


